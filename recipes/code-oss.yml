app: code-oss
desc: The Open Source build of Visual Studio Code (vscode) editor
patch: false
url: https://github.com/microsoft/vscode/archive/refs/tags/1.55.0.tar.gz
script:
  - yarn --cwd code-1.55.0 preinstall
  - yarn --cwd code-1.55.0 install
  - yarn --cwd code-1.55.0 gulp vscode-linux-x64
  - yarn --cwd code-1.55.0 postinstall
  - mkdir -p usr/share/{metainfo,icons/hicolor/scalable/apps,applications}
  - mkdir -p usr/bin
  - cp code-1.55.0/resources/linux/code.{png,desktop} .
  - mv VSCode-linux-x64 usr/share/code-oss
  - ln ../share/code-oss/code-oss usr/bin/code-oss

appRun: |
  #!/bin/sh
  VSCODE_PATH=${APPDIR}/usr/share/code-oss
  ELECTRON=$VSCODE_PATH/code-oss
  CLI=$VSCODE_PATH/resources/app/out/cli.js
  env GDK_BACKEND=x11 $ELECTRON $CLI $@
  exit $?